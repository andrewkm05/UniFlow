{% extends "base.html" %}

{% block title %}Schedule ~ UniFlow{% endblock %}

{% block content %}

<div class="container py-5" style="margin-top: 40px;">

    <!-- Header row: Title and Actions-->
    
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <h1 class="fw-bold display-6 text-uppercase">Weekly Schedule</h1>

        <div class="d-flex gap-2">
            <!-- Global Add button -->
            <button class="btn btn-primary-uf rounded-pill px-4" type="button" data-bs-toggle="modal" data-bs-target="#scheduleModal" data-mode="create">
                Add + 
            </button>

            <!-- Clear Table button-->
            <form action="{{ url_for('schedule_clear')}}" method="post" class="mb-0">
                <button id="clear-btn" class="btn btn-outline-uf rounded-pill px-4" type="submit">
                    Clear
                </button>
            </form>
        </div>
    </div>
    
    <div class="table-wrap">
        <!-- Week grid -->
        <div class="row g-3" id="week">
            {% for d in days %}
            <div class="col-12 col-md-6 col-lg-3 col-xl">
                <div class="card h-100 shadow-sm">
                    <!-- "Days" headers -->
                    <div class="card-header fw-bold text-center" style="background-color: var(--uf-brown); color: #fff;">
                        <span class="fw-bold text-uppercase">{{ d }}</span>

                        <!-- Add button per day -->
                        <button class="btn btn-sm rounded-pill px-3" style="color: var(--uf-brown-200);" type="button" data-bs-toggle="modal" data-bs-target="#scheduleModal" data-mode="create" data-weekday="{{ loop.index0 }}">
                            (+ Add)
                        </button>
                    </div>

                    <!-- Day list -->
                    <ul class="list-group list-group-flush day-list" data-day="{{ loop.index0 }}">
                        {% for it in items_by_day[loop.index0] %}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="fw-semibold">{{ it.title }}</div>
                                    <div class="small text-muted">{{ it.start_time }}-{{ it.end_time }}</div>

                                    {% if it.notes %}
                                        <div class="small text-muted">{{ it.notes }}</div>
                                    {% endif %}
                                </div>

                                <form action="{{ url_for('schedule_delete', item_id=it.id) }}" method="post" class="ms-3">
                                    <button class="btn btn-pill btn-actions" title="Delete" onclick="return confirm('Delete this slot?')">
                                        x
                                    </button>
                                </form>
                            </li>
                        {% endfor %}

                        {% if not items_by_day[loop.index0] %}
                            <li class="list-group-item text-muted small">No entries</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add / Edit -->
<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Header -->
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="scheduleModalLabel">
                    Add slot
                </h5>

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Form for add/edit -->
            <form id="scheduleForm" action="{{ url_for('schedule_save') }}" method="post">
                <div class="modal-body">

                    <input type="hidden" name="id" id="f-id">

                    <div class="row g-3">

                        <!-- Day -->
                        <div class="col-12 col-md-4">
                            <label class="form-label">Day</label>

                            <select class="form-control" name="weekday" id="f-day" required>
                                <option value="0">Monday</option>
                                <option value="1">Tuesday</option>
                                <option value="2">Wednesday</option>
                                <option value="3">Thursday</option>
                                <option value="4">Friday</option>
                                <option value="5">Saturday</option>
                                <option value="6">Sunday</option>
                            </select>
                        </div>

                        <!-- Start time -->
                        <div class="col-6 col-md-4">
                            <label class="form-label">Start</label>

                            <input class="form-control" type="time" name="start_time" id="f-start" value="14:00" required>
                        </div>

                        <!-- End time -->
                        <div class="col-6 col-md-4">
                            <label class="form-label">End</label>

                            <input class="form-control" type="time" name="end_time" id="f-end" value="15:00" required>
                        </div>

                        <!-- Title -->
                        <div class="col-12">
                            <label class="forn-label">Title</label>

                            <input class="form-control" type="text" name="title" id="f-title" required>
                        </div>

                        <!-- Notes -->
                        <div class="col-12">
                            <label class="form-label">Notes</label>

                            <textarea class="form-control" name="notes" id="f-notes" rows="3"></textarea>
                        </div>
                    </div>                    
                </div>

                <div class="modal-footer">
                    <button class="btn btn-pill btn-actions" type="button" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    
                    <button class="btn btn-pill btn-actions" type="submit">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/schedule.js') }}" defer></script>

{% endblock %}
